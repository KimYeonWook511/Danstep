# 24.07.17

### ERD

- 임시 ERD
    ![ERD.PNG](./img/ERD.PNG)

- user_info 테이블에서 소셜로그인 부분 따로 떼어내는게 나은가!? 
    - 구글이나 네이버 로그인의 경우 password에 null값 들어가야 함
    - 이렇게 되면 너무 낭비지 않나!?
    - 나누지 않는다면 편하긴 함!
    - password를 따로 관리하기가 아까움 (결국 따로 관리하려면 password만 있는 테이블이 필요해짐)
- 댄서가 강의 등록 시 썸네일 이미지 받기로 함!
- 이에 따른 컬럼 추가 필요
- lesson_info 에서의 중요 부분
    - 바로 music_singer (가수)
    - 여기에 다중 값이 들어갈 수 있도록 설계함 (서인국, 정은지)
    - 정규화를 하면 당연히 나누어서 1:N으로 풀어주는게 맞음!
    - 그러나 api로 호출하여 데이터를 받아 오면 일정한 형식으로 오기 때문에 그냥 넣어도 됨
    - 그냥 넣어도 되는 이유는 각 노래의 가수를 따로 관리해서 사용할 부분이 없음 (단지 사용자에게 이 노래 가수는 이렇게 있다의 용도)

- MySQL 기준으로 Primary Key는 BigInt 보단 UnsignedInt 사용하는 것을 추천!! (어제 오전 강의 내용)
- tinyint : 1byte = 0~255
- smallint : 2bytes = -32,768 ~ 32,767
- int : 4bytes = -2,147,483,648 ~ 2,147,483,647 


### 소셜 로그인 학습

- OAuth2
    - Open Authorization
    - 사용자의 인증과 권한 부여를 위한 프로토콜
    - 안전한 인증 및 권한 부여를 위해 사용됨
    - 주로 사용자가 다른 웹 사이트나 애플리케이션에 로그인할 때 사용됨
    - 쉽게 말하면 A서비스를 이용하는 사람들이 별다른 비밀번호나 자격증명없이 로그인할 수 있도록 B서비스에서의 접근 권한을 부여할 수 있게 하는 표준

- Access Token
    - OAuth의 핵심은 Access Token
    - 이 Access Token은 임의의 문자열 값으로, 이 문자열의 정체는 이 토큰을 발급해준 서비스만 알 수 있음 (JWT는 기본정보가 Base64로 인코딩되어 있어서 정보를 살펴볼 수 있음)
    - 즉 Access Token의 존재 자체가 고객이 정보를 넘겨주는 것을 동의함의 징표라고 할 수 있음

- Redirect
    - 고객이 로그인을 하려고 하면 소셜 로그인이 진행되고 나서 리다이렉트를 시켜주는 형식
    - 이를 통해 URL에 Access Token을 묶는, 즉 query string을 이용하여 Access Token을 받을 수 있음
    - 우리 서비스의 url은 어떻게 알려주나?!
    - 우리도 똑같이 URL에 리다이렉트 URL을 묶어서 네이버와 같은 소셜 로그인 서비스로 이동시키면 됨!
    - 여기서 XSS공격이나 피싱 사이트를 이용해서 리다이렉트 URL이 변조되면 해커가 내 Access Token을 받게 되는거 아니야!!??
    - 이것을 막기 위해 각 사이트는 OAuth를 사용하기 위해선 등록절차를 밟게됨
    - 네이버의 경우는 사전에 우리 서비스에서 네이버 로그인 기능을 사용한다고 사전에 등록하고 승인을 받아야 함
    - 심지어 입력하는 부분에 redirect_uri도 사전에 미리 합의함!

- Spring Security OAuth2 Client
    - OAuth 2.0 인증 흐름을 구현하기 위해 사용되는 프레임워크